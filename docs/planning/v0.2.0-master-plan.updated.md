# Dad Cam v0.2.0 — Master Plan (Updated)

Status: Planning  
Updated: 2026-01-28

## What is Dad Cam?

Dad Cam is a **paid, offline, cross-platform desktop app** that makes old-school digital cameras usable today and generates automatic nostalgic long-form **“VHS edits”**.

You rent out “Dad Cameras” and need an app that:
- Makes ingest + organization dead simple for end users
- Automates “VHS edits” (J & L audio blending) from their footage
- Is paid for the public, **free during rentals**, and offers a **trial**
- Works on **macOS, Windows, Linux**
- Stores metadata locally (SQLite) and never requires an account or internet

## Non-negotiables (contracts-level rules)

1. **Originals are never deleted or modified** by the app.
2. Works **100% offline** (no account, no phone-home, no telemetry).
3. SQLite is the source of truth; data is inspectable and portable.
4. Same core features on macOS/Windows/Linux.
5. Long jobs are **crash-safe and resumable** (ingest, proxy gen, scoring, export).
6. Any “export originals” feature is a **file copy**, never a transform.

## Development Focus (what hardware is in scope)

**In scope**
- USB digital cameras **as storage devices** (Mass Storage / MTP best-effort)
- Memory cards (card readers)
- File-based ingest from folders

**Out of scope (for now)**
- FireWire
- VHS/MiniDV tape capture
- Multi-camera sync / multi-view

---

# v0.2.0 Product Scope

## Primary Deliverables
1. **Settings v2** + first-run wizard (Simple vs Advanced)
2. **Licensing system** (trial, purchased, rental, dev)
3. **VHS Export** (timeline builder + FFmpeg pipeline)
4. **Import dialog** (event assignment + progress + summary)
5. **Camera system** (bundled DB + custom “Dad Cams” + matching)
6. LeftNav improvements (Favorites link, optional Cameras tab)
7. Feature toggles (Advanced only)
8. Dev menu (formulas + camera DB editing + license tools + debug)

## Not in v0.2.0
- FireWire / tape capture
- Cloud sync / subscriptions
- Multi-view camera sync
- Editing tools beyond the VHS pipeline + basic clip export

---

# User Experience Modes

## Mode names (DECIDED)
Persist and use **exactly**:
- `simple`
- `advanced`

This is not a “rename later” situation. It’s the real stored enum starting in Settings v2.

## Simple mode (Default)
- Single Project only (“Default Project”)
- Cameras tab hidden
- Feature toggles hidden
- Targets low-end PCs
- Generic camera profile fallback unless matched to DB / registered Dad Cam
- Theme: light only (no toggle)

## Advanced mode
- Multiple Projects supported
- Cameras tab available (and toggle-able)
- Feature toggles visible
- Theme toggle (light/dark)
- Can register specific cameras (“Dad Cams”)
- Dev menu access (hotkey + easter egg)

## Feature toggle defaults
| Feature | Simple | Advanced |
|---|---:|---:|
| Screen grabs | On | On |
| Face detection | Off | On |
| Best clips | On | On |
| Cameras tab | Hidden | On |

Simple mode hides the toggles entirely.

---

# Licensing & Trial

## License tiers
- **Trial**: 14 days full functionality
- **Purchased**: $99 one-time
- **Rental**: free key provided with rental (full functionality during rental window)
- **Dev**: internal key (debug-only features)

## Soft lock behavior after trial expires (DECIDED — Option A)
After 14 days, if the user does not have a Purchased or Rental license:

**CAN**
- Open app
- Open projects
- Browse/play footage
- View existing metadata, events, favorites, best-clips results (if already computed)
- **Export rendered outputs with watermark and/or 720p cap** (see below)
- **Export originals (file copy)** — always allowed (non-hostage rule)

**CANNOT**
- Import new footage
- Run “auto-edit jobs” (new scoring queues, face detection passes, “refresh best clips”)
- Register cameras (optional: you may allow reading EXIF dumps, but not saving to custom DB)

## “Export rendered outputs” restrictions (unlicensed, post-trial)
Rendered export = anything that produces a new video file via FFmpeg (VHS edit, compilation export, transcoded clip export).

Enforce at least one:
- **Watermark**: “Dad Cam Trial” (and optionally your brand) burned-in
- **720p cap**: output downscaled to 1280x720 max

**Recommended:** do both (watermark + 720p cap).

## Rental keys
Ideal: rental keys are offline-valid and embed an expiry date (or “valid until”).  
If expiry is too complex for v0.2.0, ship unlimited rental keys and add expiry in v0.3.x.

---

# Core Data Model (v0.2.0)

## Projects
User-facing term is **Project** (even if internal file/table names still say “library”).

- Simple mode: one project (“Default Project”)
- Advanced mode: multiple projects + recent projects list

## Events
Events remain many-to-many with clips (keep `event_clips` join table). Do not add `event_id` to `clips` unless you intentionally delete the join model.

- Import dialog can assign imported clips to:
  - Existing event
  - New event created inline
  - No event

## Cameras: profile vs device (FIXED MODEL)
Two concepts are required:

### 1) Camera Profile (model-level)
“Sony HDR-CX405”, “Canon VIXIA”, etc.
- make, model
- parsing hints (filename patterns)
- optional LUT/processing hints
- known quirks

### 2) Camera Device (your specific unit)
A physical rental unit (“Dad Cam”).
- stable UUID
- linked to a profile
- usb fingerprint(s) (best-effort)
- serial number (if present)
- rental notes (battery/charger type IDs)
- fleet label (e.g., DadCam-12)

### Clip camera fields
Clips should store:
- `camera_device_id` (nullable)
- `camera_profile_id` (nullable; set when device unknown but model matched)

This supports:
- Known rental cameras (device match)
- Known consumer camera models (profile match)
- Unknown cameras (generic fallback)

---

# Camera Matching

## Sources
- Bundled camera DB: `resources/cameras/canonical.json`
- Custom fleet DB: `~/.dadcam/custom_cameras.json`

The system must work without bundled DB: generic fallback + custom devices.

## Matching priority
1. Custom **device** match by USB fingerprint (100% when available)
2. Custom **device** match by serial number (95%)
3. Custom **device** match by make+model + strong heuristics (80%)
4. Bundled **profile** match by make+model (80%)
5. Bundled **profile** match by filename pattern (70%)
6. Unknown → generic profile silently

Unknown cameras should not interrupt Simple mode flow.

---

# Ingest & Import Dialog

## Import UX (must exist in v0.2.0)
User clicks **Import Footage** → Import dialog:
- Folder picker
- Assign to Event dropdown:
  - Existing event
  - Create new event inline
  - No event
- Start import
- Live progress (discovered / copied / indexed / preview generated)
- Summary:
  - clips imported
  - camera breakdown (Advanced only)
  - event assignment summary

## Import pipeline (per file)
1. Discover files (with resumable manifest)
2. Copy or reference into project (depending on existing design)
3. Hash (BLAKE3)
4. Extract metadata (ffprobe + exiftool or equivalent)
5. Camera match → set device/profile IDs
6. Generate preview assets (proxy/thumbnail/sprite)
7. Insert DB records
8. If event chosen → insert `event_clips` rows

## Job/Progress standardization (REQUIRED)
All long operations (ingest, preview gen, scoring, export) must use one shared progress schema:

**Progress payload**
- `job_id`
- `phase` (discover/copy/metadata/preview/db/etc)
- `current`, `total`, `percent`
- `message`
- `is_cancelled`, `is_error`, `error_message?`

---

# VHS Edit System (Export)

## Definition
A VHS Edit is a single long timeline built from chosen clips with:
- Video crossfades
- J & L audio blending between clips
- Optional opening title text

## Title overlay
- Optional title text in export dialog
- Title starts at **5 seconds** (default), adjustable in Dev Menu
- Duration: 3s (0.5 fade in, 2 hold, 0.5 fade out)
- Centered text with subtle background plate

## J & L blending
- Default blend duration: 500ms (Dev Menu adjustable)
- Use FFmpeg filtergraph (xfade + acrossfade) with consistent normalization:
  - normalize sample rate/layout
  - handle missing audio gracefully
  - conform FPS/resolution to avoid filtergraph failures

## Selection modes
- By Date range
- By Event
- Favorites only
- All clips above score threshold (Advanced)
- All clips

## Ordering
- Chronological (default)
- Score descending / ascending
- Shuffle

## Export history
Implement durable export history as either:
- a dedicated `exports` table, or
- job metadata in a `jobs` table indexed by job type.

Minimum fields:
- output path
- created_at
- selection params (mode/order/filters)
- title text
- resolution/watermark flags
- status + duration

---

# Sidecars & Metadata

## Sidecar location
Store sidecars in the project data folder (e.g., `.dadcam/sidecars/`), keyed by clip ID.  
Never write next to originals by default.

## Sidecar contents (JSON)
- original file path
- file hash (BLAKE3)
- metadata snapshot (ffprobe + EXIF)
- camera match result (device/profile + confidence)
- ingest timestamps
- derived asset paths (proxy/thumb/sprite)
- optional: rental audit fields

Dev menu should include “export EXIF dump” tooling.

---

# Dev Menu (v0.2.0 requirement)

Access:
- Hotkey: Cmd+Shift+D (mac) / Ctrl+Shift+D (win/linux)
- Easter egg: click version 7x

Sections:
1. **Formulas**
   - Title start time (seconds)
   - J/L blend duration (ms)
   - Score weights (scene/audio/sharpness/motion)
   - Trial watermark text (optional)
2. **Camera Database**
   - View bundled profiles
   - View custom devices
   - Register new device (from sample clips; USB best-effort)
   - Import/export JSON
3. **License Tools**
   - View license state
   - Activate key
   - Generate rental keys (batch)
   - Clear/reset trial (dev)
4. **Debug**
   - View logs
   - FFmpeg test
   - Clear caches
   - Export database
   - Raw SQL (DEV KEY ONLY)

Raw SQL must be gated behind Dev license.

---

# Packaging / External Dependencies (Decision: bundle)

Bundle FFmpeg (and any required metadata tools) per-platform so the app works offline.  
Provide a Dev Menu “FFmpeg test” button.

---

# Migration (v0.1.x → v0.2.0)

## Settings migration
On load, if settings version < 2:
- `personal` → `simple`
- `pro` → `advanced`
- `firstRunCompleted = true`
- Initialize defaults: feature flags, dev formulas, theme

## Data migration
- Keep existing DB tables and joins
- Add camera device support via migration(s)
- Keep events join table model

## Trial start
Trial begins on first v0.2.0 launch unless a valid license exists.

---

# Implementation Order (Dependency-correct)

1. **Settings v2** (including `simple|advanced` persistence + migration)
2. **Unified job progress/cancel plumbing**
3. **Licensing** (trial + purchased + rental + soft lock rules)
4. **Export MVP** (VHS pipeline + history + watermark/720p enforcement)
5. **Camera system MVP** (profiles + devices + matching; registration from sample clips)
6. **Import dialog** (event assignment + progress + camera breakdown)
7. LeftNav updates (Favorites link + Cameras tab gating)
8. Feature toggles (Advanced-only UI)
9. Dev menu (formulas + camera DB + license tools + debug)
10. USB registration (best-effort; fallback always exists)
11. Theme toggle wiring (Advanced only)

---

# Backend Checklist (Rust / Tauri)

## 1) Settings v2
- Expand settings struct:
  - `version: 2`
  - `mode: "simple" | "advanced"`
  - `firstRunCompleted: bool`
  - `theme: "light" | "dark"`
  - `defaultProjectPath: Option<String>`
  - `recentProjects: []`
  - `featureFlags: { screenGrabs, faceDetection, bestClips, camerasTab }`
  - `devMenu: { titleStartSeconds, jlBlendMs, scoreWeights, watermarkText? }`
  - `licenseStateCache: Option<…>` (safe summary only; secrets in keychain)
- Migration: v1 → v2 including `personal/pro` mapping

## 2) Jobs progress standardization
- Single progress event contract for ingest/export/scoring
- Cancellation token support
- Persist job logs

## 3) Licensing
- Local key validation + keychain storage
- License types: Trial/Purchased/Rental/Dev
- Soft lock checks:
  - block import
  - block new analysis jobs
  - allow rendered export but enforce watermark/720p caps
  - always allow exporting originals (copy)

## 4) Export (VHS)
- Timeline builder (selection + ordering)
- FFmpeg builder:
  - xfade + acrossfade
  - title overlay
  - normalization rules
  - watermark + 720p enforcement when restricted
- Export job runner
- Export history persistence

## 5) Camera system
- Load bundled profiles (graceful fallback)
- Load custom devices JSON
- Matching engine returns device/profile + confidence + reason
- DB migrations:
  - add `camera_device_id`, `camera_profile_id` to clips (or equivalent)
  - add `camera_devices` table if not present

## 6) Import enhancement
- Import command accepts optional event selection
- Emits progress events
- Inserts into `event_clips`
- Stores camera match IDs

## 7) Dev menu backend
Commands for:
- read/write dev formulas
- list cameras (bundled + custom)
- register camera device (from sample clips)
- license tools
- debug tools (FFmpeg test, clear caches, export DB)
- raw SQL (dev key only)

## 8) USB registration (late)
- Best-effort enumeration per OS
- MUST have fallback “register from sample clips” flow

---

# Frontend Checklist (React / TS)

## 1) Types + Settings v2
- Update AppMode type:
  - `type AppMode = "simple" | "advanced"`
- Expand `AppSettings` to match backend
- Wire first-run wizard gating

## 2) First-run wizard
- Step 1: pick Simple vs Advanced
- Step 2 (Simple): pick Default Project folder
- Step 2 (Advanced): go to Projects dashboard or open/create project

## 3) Licensing UI
- Trial banner (days remaining)
- Soft lock messaging:
  - Import disabled + CTA
  - Export shows “Trial watermark/720p” indicator
- Key entry modal
- Dev menu license tools

## 4) Export UI
- Export dialog (selection/order/title/output preset)
- Progress + cancel
- Export history list

## 5) Import dialog UI
- Folder picker
- Event assignment + inline create
- Progress view
- Summary with camera breakdown (Advanced only)

## 6) Cameras UI (Advanced)
- Cameras tab gated by mode + feature flag
- List grouped by device/profile
- Unknown camera bucket
- Registration entry via Dev menu

## 7) LeftNav improvements
- Favorites nav link that sets filter in existing grid
- Cameras section appears only when enabled

## 8) Feature toggles (Advanced only)
- Settings page shows toggles only in Advanced
- Hide features when toggles off

## 9) Theme toggle (Advanced only)
- Apply `.dark-mode` on root based on settings theme

## 10) Dev menu UI
- Formulas editor
- Camera DB manager
- License tools
- Debug tools

---

# Test Plan (Must-pass)

## Licensing & lock states
- Trial starts and counts down correctly
- After expiry:
  - Import disabled
  - New analysis jobs disabled
  - Rendered export allowed but watermarked/720p
  - Export originals always allowed

## Import
- Import survives interruption and resumes
- Event assignment inserts correct join rows
- Camera detection never blocks import (generic fallback works)

## Export
- VHS pipeline handles mixed codecs / missing audio
- Watermark + 720p enforced in restricted state
- Export history records correctly

## Cross-platform
- Keychain storage works on macOS/Windows/Linux
- Bundled FFmpeg callable
- Dev menu shortcuts work

---

# Decisions Log (Updated)

- Mode persistence: `simple|advanced` (stored, not UI-only)
- Trial soft lock: block import + new auto-edit jobs; allow rendered export with watermark/720p; always allow exporting originals
- Bundle FFmpeg (offline requirement)
- Events remain many-to-many via join table
- Cameras modeled as **Profile + Device**
- USB registration best-effort; “register from sample clips” is the reliable baseline
